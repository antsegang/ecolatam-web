<section class="hero reveal">
  <div class="container hero-inner">
    <div class="hero-copy">
      <div class="eyebrow">Usuarios</div>
      <h1>Directorio</h1>
      <p class="lead">Explora los miembros. Busca por nombre o usuario.</p>
    </div>
  </div>
</section>

<section class="section panel">
  <div class="container">
    <form class="search-row" (ngSubmit)="onSubmit()" [formGroup]="form" autocomplete="off" role="search">
      <input formControlName="q" placeholder="Buscar por nombre o usuario…" aria-label="Buscar usuarios" />
      <button class="btn" type="submit" [disabled]="loading()">Buscar</button>
    </form>

    @if (!loading()) {
      @if (pageData(); as page) {
        <div class="grid cards" [attr.aria-busy]="loading()">
          <article class="card reveal user-tile" *ngFor="let u of page.items; trackBy: trackById">
            <a class="cover" [routerLink]="['/users', u.id]" aria-label="Ver perfil">
              <img [src]="'/avatar-placeholder.png'"
                   [alt]="(u.name || '') + ' ' + (u.lastname || '')" loading="lazy" />
            </a>

            <div class="body">
              <h3 class="title">
                <a [routerLink]="['/users', u.id]">{{ u.name }} {{ u.lastname }}</a>
              </h3>

              <p class="sub">
                <span *ngIf="u.username" class="badge">&#64;{{ u.username }}</span>
                <ng-container *ngIf="u.username && u.email"> · </ng-container>
                <a *ngIf="u.email" [href]="'mailto:' + u.email">{{ u.email }}</a>
              </p>

              <ul class="meta">
                <li *ngIf="u.locationLabel"><i></i>{{ u.locationLabel }}</li>
                <li *ngIf="u.createdAt"><i></i>Miembro desde {{ u.createdAt | date:'longDate' }}</li>
              </ul>

              <div class="actions">
                <a class="btn-ghost sm" [routerLink]="['/users', u.id]">Ver perfil</a>
              </div>
            </div>
          </article>
        </div>

        <!-- Paginador fuera del grid -->
        <div class="pager">
          <button class="btn-ghost" (click)="prev()" [disabled]="page.offset === 0 || loading()">← Anterior</button>
          <span class="muted">
            Mostrando {{ page.offset + 1 }} – {{ page.offset + (page.items.length || 0) }}
            <ng-container *ngIf="page.total as t"> de {{ t }}</ng-container>
          </span>
          <button class="btn-ghost" (click)="next()" [disabled]="!page.hasMore || loading()">Siguiente →</button>
        </div>
      } @else {
        <p class="muted empty-state">No hay resultados.</p>
      }
    } @else {
      <div class="grid cards" aria-live="polite">
        <div class="card reveal skeleton" *ngFor="let x of [0,1,2,3,4,5,6,7,8,9,10,11]"></div>
      </div>
    }
  </div>
</section>
