<section class="section panel">
  <div class="container">
    <ng-container *ngIf="loading(); else ready">
      <div class="skeleton profile" aria-live="polite"></div>
    </ng-container>

    <ng-template #ready>
      <ng-container *ngIf="user() as u; else noUser">
        <article class="profile-card">
          <app-profile-cover [canEdit]="isSelf()"></app-profile-cover>

          <app-profile-header [user]="u" [isSelf]="isSelf()" [myRoles]="myRoles()" [kycPassed]="kycPassed()" [locationLabel]="locationLabel()" (kycClick)="openKycModal()"></app-profile-header>

          <app-profile-stats [stats]="stats()" [kycPassed]="kycPassed()" [myRoles]="myRoles()"></app-profile-stats>

          <app-profile-tabs [tab]="tab()" (tabChange)="setTab($event)" [user]="u" [posts]="posts()" [isSelf]="isSelf()" [paisLabel]="getPaisLabel()" [provinciaLabel]="getProvinciaLabel()" [cantonLabel]="getCantonLabel()" [distritoLabel]="getDistritoLabel()"></app-profile-tabs>
        </article>
      </ng-container>
      <ng-template #noUser>
        <p class="muted">No se encontró el usuario.</p>
      </ng-template>
    </ng-template>
  </div>
</section>

<!-- Modal KYC -->
<div class="modal-backdrop" *ngIf="kycOpen()"></div>
<div class="modal" *ngIf="kycOpen()" role="dialog" aria-modal="true" (click)="closeKycModal()">
  <div class="modal-content card" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Presentar KYC</h2>
      <button class="btn-ghost btn-icon" (click)="closeKycModal()" aria-label="Cerrar">✕</button>
    </div>
    <form [formGroup]="kycForm" (ngSubmit)="submitKycModal()">
      <div class="grid two">
        <label><span>Tipo de identificación (ID)</span>
          <input type="number" formControlName="id_idtype" placeholder="Ej. 1" />
        </label>
        <label><span>Número de identificación</span>
          <input type="text" formControlName="identity" placeholder="Tu documento" />
        </label>
      </div>
      <label><span>Fotografías (máx 5)</span>
        <input type="file" (change)="kycForm.controls.pictures.setValue($any($event.target).files)" multiple accept="image/*" />
      </label>
      <p class="error" *ngIf="kycError()">{{ kycError() }}</p>
      <div class="modal-actions">
        <button type="button" class="btn-ghost" (click)="closeKycModal()" [disabled]="kycSubmitting()">Cancelar</button>
        <button type="submit" class="btn" [disabled]="kycSubmitting() || kycForm.invalid">Enviar</button>
      </div>
    </form>
  </div>
</div>
